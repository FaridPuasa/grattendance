<!DOCTYPE html>
<html>
<head>
    <title>Sign In</title>
    
    <!-- Include the Bing Maps script -->
    <script src="https://www.bing.com/api/maps/mapcontrol?key=AgkWMZlk5ts6xb8cJkzUar2iJMWTexduafRzsyANqeAF2b_PN0D2CZAKo8hfNqkB" async defer></script>
</head>
<body>
    <h1>Sign In</h1>

    <!-- Add a div for the Bing Maps -->
    <div id="map" style="width: 50%; height: 400px;"></div>

   <!-- Form for sign-in -->
    <form id="signInForm" method="POST" action="/signin">
        <label for="username">Username:</label>
        <input type="text" name="username" required>
        <input type="hidden" name="action" value="Sign In">
        <label for="time">Sign In Time:</label>
        <input type="time" name="timestamp" required>
        <button type="button" onclick="getLocation('signIn')">Get Location for Sign In</button>
        <button type="submit">Sign In</button>
    </form>

    <!-- Your JavaScript for Bing Maps integration -->
    <script>
        let map;

        function loadMapScenario() {
            // Initialize Bing Maps
            map = new Microsoft.Maps.Map(document.getElementById('map'), {
                credentials: 'YOUR_BING_MAPS_API_KEY' // Replace with your Bing Maps API key
            });
        }

        // Function to update the map with the user's location
        function updateMapWithLocation(latitude, longitude) {
            // Code to update the Bing Map with the user's location
            // Use latitude and longitude to set the map view and display a marker
            // Example code:
            const userLocation = new Microsoft.Maps.Location(latitude, longitude);
            map.setView({ center: userLocation, zoom: 10 });

            const pin = new Microsoft.Maps.Pushpin(userLocation);
            map.entities.push(pin);
        }

        // Function to retrieve the user's location
        function getLocation(action) {
            // Code to get the user's location and update the map
            // Use the updateMapWithLocation function to display the location on the map
            // Example code (similar to your existing code):
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    updateMapWithLocation(latitude, longitude);

                    if (action === 'signIn') {
                        document.getElementById('locationInput').value = 'Fetching location...';
                    }
                }, function(error) {
                    // Handle errors
                    console.error("Error getting location:", error.message);
                });
            } else {
                // Handle case where geolocation is not available
                console.log("Geolocation is not supported in this browser.");
            }
        }

        // Load the Bing Map when the window loads
        window.onload = function() {
            loadMapScenario();
        };
    </script>
</body>
